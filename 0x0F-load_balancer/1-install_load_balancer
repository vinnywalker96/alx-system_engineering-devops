#!/usr/bin/env bash
# configure haproxy load-balancing server
sudo apt-get update
sudo apt-get install --no-install-recommends software-properties-common -y
sudo add-apt-repository ppa:vbernat/haproxy-2.7 -y
sudo apt-get update
sudo apt-get install haproxy=2.7.* -y

CONFIG=\
"
frontend http-in
    mode http
    bind *:80
    default_backend nodes

backend nodes
    mode http
    balance roundrobin
    server 105775-web-01 18.234.80.132:80 check
    server 105775-web-02 100.25.160.25:80 check
"
sudo bash -c "echo -e '$CONFIG' > /etc/haproxy/haproxy.cfg"
sudo systemctl restart haproxy
